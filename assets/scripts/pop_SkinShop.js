var e=require;
var t=module;
var o=exports;
"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var i,a=arguments.length,r=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(r=(a<3?i(r):3<a?i(t,o,r):i(t,o))||r);return 3<a&&r&&Object.defineProperty(t,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r,c=e("AppCommon"),l=e("CCTool"),s=e("BaseSdk"),p=e("PlatformFun"),d=e("UserVo"),u=e("GridView"),f=e("Cfg"),h=e("SkinCtrl"),m=e("pop"),t=cc._decorator,e=t.ccclass,t=t.property,e=(r=m.default,i(y,r),y.prototype.getList=function(){this.selectPageIndex=1,this.roleList.length=0;var e,t=f.Cfg.RoleMan.getAll();for(e in t)this.roleList.push(t[e]);this.roleList.sort(function(e,t){return e.sequence-t.sequence}),this.ghostList.length=0,this.ghostList=f.Cfg.RoleGhost.filter({}),this.ghostList.sort(function(e,t){return e.sequence-t.sequence}),this.loadRoleInfo(0),p.PlatformFun.SendEvent("role_show")},y.prototype.loadRoleInfo=function(e){var o=this,t=1===this.selectPageIndex?this.roleList:this.ghostList;e>=t.length?e=0:e<0&&(e=t.length-1),this.selectIndex=e;var n=t[this.selectIndex],e=1===this.selectPageIndex?d.UserVo.useSkin==n.id:d.UserVo.useBossSkin==n.id,i=d.UserVo.getSkin(n.id);this.selectItem=n,this.labelArr[0].string="姓名："+n.name+"\n岗位："+n.profession+"\n籍贯："+n.hometown,this.labelArr[1].string=n.story,1e4==n.id?new l.CCTool.Egg({type:"Click",num:5,node:this.labelArr[1].node,call:function(){l.CCTool.UI.OpenPop("prefab/pop/pop_UIYunNanBGM")}}):this.labelArr[1].node.targetOff(this.labelArr[1].node);t=[];if(1===this.selectPageIndex){var a=t;for(r in n.skillID)i?a.push(f.Cfg.SkillMan.get(d.UserVo.data.skinSkill[n.id][r])):a.push(f.Cfg.SkillMan.get(n.skillID[r]))}else{var r,s=t;for(r in n.skillID)i?s.push(f.Cfg.SkillGhost.get(d.UserVo.data.skinSkill[n.id][r])):s.push(f.Cfg.SkillGhost.get(n.skillID[r]))}this.skillList=t,this.setSkillInfo(t,i);t=this.nodeArr[2].children;t[1].active=t[2].active=t[3].active=!1,t[1].active=!i,t[2].active=i&&!e,t[3].active=i&&e,cc.resources.load(n.RoleBones,sp.SkeletonData,function(e,t){if(!t)return cc.log("下载失败");if(!o.roleSkeleton)return cc.log("没有对象");o.roleSkeleton.skeletonData=t,o.roleSkeleton.setAnimation(0,"idle",!0),o.roleSkeleton.node.scale=1===o.selectPageIndex?2:1;t=1===o.selectPageIndex?h.RoleSkinType.ROLE:h.RoleSkinType.BOSS;t==h.RoleSkinType.ROLE&&(c.default.SkinCtrl.setRoleClothes(t,o.roleSkeleton,n.id,0),c.default.SkinCtrl.setRoleHead(t,o.roleSkeleton,n.id),c.default.SkinCtrl.setRoleHat(t,o.roleSkeleton,0),c.default.SkinCtrl.setRoleWing(t,o.roleSkeleton,0))})},y.prototype.setSkillInfo=function(t,n){var i=this;this.nodeArr[0].active=this.nodeArr[1].active=!0;for(var e=this.nodeArr[1],o=0,a=e.childrenCount;o<a;o++)e.children[o].opacity=0==o?t.length<=1?255:0:t.length<=1?0:255;var r,s=this;for(r in t)!function(e){var o=s.nodeArr[e];o.children[2].getComponent(cc.Label).string=n?t[e].name:"神秘技能",o.children[3].getComponent(cc.Label).string=n?t[e].introduction:"聘用该角色可查看该角色技能。",o.children[5].children[0].getComponent(cc.Label).string="Lv"+t[e].lvInfo[0],o.children[5].active=n,o.children[6].active=n&&!!t[e].lvInfo[1],cc.resources.load(n?t[e].iconPath:"img/gameIcon/wenhao",cc.SpriteFrame,function(e,t){i&&(o.children[4].getComponent(cc.Sprite).spriteFrame=t)})}(r);this.setPoint()},y.prototype.switchRole=function(){this.loadRoleInfo(this.selectIndex++)},y.prototype.setPoint=function(){var e,t=this.nodeArr[3].children;for(e in t)t[e].active=!1;for(e in 1===this.selectPageIndex?this.roleList:this.ghostList){var o=t[e];o||(o=cc.instantiate(t[0])).setParent(this.nodeArr[3]),o.opacity=this.selectIndex==+e?200:100,o.active=!0}},y.prototype.onButton=function(e,t){var o=this;switch(e&&l.CCTool.Audio.Player("Click"),t){case"Close":this.close();break;case"Prev":this.loadRoleInfo(this.selectIndex-1);break;case"Next":this.loadRoleInfo(this.selectIndex+1);break;case"Use":1==this.selectPageIndex?d.UserVo.useSkin=this.selectItem.id:d.UserVo.useBossSkin=this.selectItem.id,this.loadRoleInfo(this.selectIndex);break;case"Unlock":p.PlatformFun.loadRewardedVideoAd({onVideoSuccess:function(){1==o.selectPageIndex?(d.UserVo.setSkin(o.selectItem.id),d.UserVo.useSkin=o.selectItem.id):2==o.selectPageIndex&&(d.UserVo.setBossSkin(o.selectItem.id),d.UserVo.useBossSkin=o.selectItem.id),o.loadRoleInfo(o.selectIndex),p.PlatformFun.SendEvent("role_unlock_"+o.selectItem.id)},loadSuccess:function(){}});break;case"VideoUpLv_1":case"VideoUpLv_2":p.PlatformFun.loadRewardedVideoAd({onVideoSuccess:function(){var e=+t.split("_")[1],e=o.skillList[e-1];d.UserVo.upSkillLv(o.selectItem.id,e),o.loadRoleInfo(o.selectIndex),l.CCTool.UI.ShowToast("升级成功"),p.PlatformFun.SendEvent("skill_levelup_"+e.type)},loadSuccess:function(){}});break;case"Toggle":var n=Number(e.node.name.substring(6));this.selectPageIndex=n,this.loadRoleInfo(0)}},y.prototype.close=function(){r.prototype.close.call(this),p.PlatformFun.destroyInterstitialAd()},a([t(u.default)],y.prototype,"gridView",void 0),a([t(sp.Skeleton)],y.prototype,"roleSkeleton",void 0),a([e],y));function y(){var e=null!==r&&r.apply(this,arguments)||this;return e.gridView=null,e.roleSkeleton=null,e.selectIndex=0,e.roleList=[],e.ghostList=[],e.selectPageIndex=0,e.initFun={pop_SkinShop:function(){e.getList(),c.default.PF==s.GAMEPF.ADR_XM&&p.PlatformFun.showBannerAd(),p.PlatformFun.SendEvent("role_show")}},e}o.default=e