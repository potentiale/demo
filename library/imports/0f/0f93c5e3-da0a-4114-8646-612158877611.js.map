{"version":3,"sources":["assets\\scripts\\TaskCtrl.js"],"names":["e","require","t","module","o","exports","Object","defineProperty","value","TaskType","n","i","c","l","p","d","a","GetBuilding","r","prototype","initTask","taskCfgList","Cfg","Task","filter","mode","sort","id","curTaskMode","_taskInfo","length","target","s","push","taskId","curPro","allPro","_curFinishNum","UserVo","getTaskInfo","Notifier","send","ListenID","Task_ShowTarget","updateTask","indexOf","buildId","Task_UpdateTarget","finishTask","console","warn","GScene","player","setCoin","reward","cc","v2","parent","convertToWorldSpaceAR","position","MainView","PopBox","convertToNodeSpaceAR","CCTool","UI","showCurrencyTips","setTaskModeFinish","addListener","Task_UpdateTask","Task_FinishTask"],"mappings":"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","sourceRoot":"/","sourcesContent":["var e=require;\nvar t=module;\nvar o=exports;\n\"use strict\";Object.defineProperty(o,\"__esModule\",{value:!0}),o.TaskType=void 0;var n=e(\"AppCommon\"),i=e(\"CCTool\"),c=e(\"UserVo\"),l=e(\"ListenID\"),p=e(\"Notifier\"),d=e(\"Cfg\"),a=o.TaskType||(o.TaskType={});a[a.GetBuilding=1]=\"GetBuilding\";r.prototype.initTask=function(e){this.taskCfgList=d.Cfg.Task.filter({mode:e}),this.taskCfgList.sort(function(e,t){return e.id-t.id}),this.curTaskMode=e,this._taskInfo={};for(var t=0,o=this.taskCfgList.length;t<o;t++){for(var n=this.taskCfgList[t],i=n.target[n.target.length-1],a=[],r=0,s=n.target.length-1;r<s;r++)a.push(n.target[r]);i={taskId:n.id,target:a,curPro:0,allPro:i};this._taskInfo[n.id]=i}this._curFinishNum=0,c.UserVo.getTaskInfo()[e]||(e=this.taskCfgList[this._curFinishNum])&&p.Notifier.send(l.ListenID.Task_ShowTarget,e,this._taskInfo[e.id])},r.prototype.updateTask=function(e,t){if(e==a.GetBuilding)for(var o in this._taskInfo){o=this._taskInfo[o];-1!=o.target.indexOf(t.buildId)&&(o.curPro+=1,p.Notifier.send(l.ListenID.Task_UpdateTarget,o))}},r.prototype.finishTask=function(e,t){var o=this.taskCfgList[this._curFinishNum];e!=o.id&&console.warn(\"任务id不对\",e,o.id),n.default.GScene.player&&n.default.GScene.player.setCoin(o.reward);e=cc.v2(0,0);t&&(t=t.parent.convertToWorldSpaceAR(t.position),e=n.default.MainView.PopBox.convertToNodeSpaceAR(t)),i.CCTool.UI.showCurrencyTips(\"Fish coin\",o.reward,!0,e),this._curFinishNum++;e=this.taskCfgList[this._curFinishNum];e?p.Notifier.send(l.ListenID.Task_ShowTarget,e,this._taskInfo[e.id]):c.UserVo.setTaskModeFinish(this.curTaskMode)},e=r;function r(){this.taskCfgList=[],this._taskInfo={},this.curTaskMode=-1,this._curFinishNum=0,p.Notifier.addListener(l.ListenID.Task_UpdateTask,this.updateTask,this),p.Notifier.addListener(l.ListenID.Task_FinishTask,this.finishTask,this)}o.default=e"]}